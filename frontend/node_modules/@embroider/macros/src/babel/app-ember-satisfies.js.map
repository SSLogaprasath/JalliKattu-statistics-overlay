{"version":3,"file":"app-ember-satisfies.js","sourceRoot":"","sources":["app-ember-satisfies.ts"],"names":[],"mappings":";;;;;AAsBA,oCAqBC;AAxCD,mCAAmC;AACnC,oDAA4B;AAC5B,mDAA8C;AAE9C,MAAM,KAAK,GAAG,IAAI,GAAG,EAA0B,CAAC;AAEhD,SAAS,kBAAkB,CAAC,KAAY;;IACtC,IAAI,OAAO,GAAG,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC;IAEzC,IAAI,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC;QACvB,OAAO,KAAK,CAAC,GAAG,CAAC,OAAO,CAAE,CAAC;IAC7B,CAAC;IAED,IAAI,GAAG,GAAG,KAAK,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;IAC1C,IAAI,OAAO,GAAmB,MAAA,MAAA,GAAG,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,cAAc,CAAC,0CAAE,OAAO,mCAAI,KAAK,CAAC;IACtG,KAAK,CAAC,GAAG,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;IAC5B,OAAO,OAAO,CAAC;AACjB,CAAC;AAED,SAAwB,iBAAiB,CAAC,IAAgC,EAAE,KAAY;IACtF,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;QACrC,MAAM,IAAA,eAAK,EAAC,IAAI,EAAE,4DAA4D,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,CAAC;IAC9G,CAAC;IACD,MAAM,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC;IACpC,IAAI,KAAK,CAAC,IAAI,KAAK,eAAe,EAAE,CAAC;QACnC,MAAM,IAAA,eAAK,EACT,IAAA,2BAAW,EAAC,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,EACrC,iEAAiE,CAClE,CAAC;IACJ,CAAC;IAED,IAAI,eAAe,GAAG,kBAAkB,CAAC,KAAK,CAAC,CAAC;IAEhD,IAAI,CAAC,eAAe,EAAE,CAAC;QACrB,OAAO,KAAK,CAAC;IACf,CAAC;IAED,OAAO,IAAA,kBAAS,EAAC,eAAe,EAAE,KAAK,CAAC,KAAK,EAAE;QAC7C,iBAAiB,EAAE,IAAI;KACxB,CAAC,CAAC;AACL,CAAC","sourcesContent":["import type { NodePath } from '@babel/traverse';\nimport type { types as t } from '@babel/core';\nimport type State from './state';\nimport { satisfies } from 'semver';\nimport error from './error';\nimport { assertArray } from './evaluate-json';\n\nconst CACHE = new Map<string, string | false>();\n\nfunction getAppEmberVersion(state: State): string | false {\n  let appRoot = state.packageCache.appRoot;\n\n  if (CACHE.has(appRoot)) {\n    return CACHE.get(appRoot)!;\n  }\n\n  let app = state.packageCache.get(appRoot);\n  let version: string | false = app.dependencies.find(d => d.name === 'ember-source')?.version ?? false;\n  CACHE.set(appRoot, version);\n  return version;\n}\n\nexport default function appEmberSatisfies(path: NodePath<t.CallExpression>, state: State): boolean {\n  if (path.node.arguments.length !== 1) {\n    throw error(path, `appEmberSatisfies takes exactly one argument, you passed ${path.node.arguments.length}`);\n  }\n  const [range] = path.node.arguments;\n  if (range.type !== 'StringLiteral') {\n    throw error(\n      assertArray(path.get('arguments'))[0],\n      `the only argument to appEmberSatisfies must be a string literal`\n    );\n  }\n\n  let appEmberVersion = getAppEmberVersion(state);\n\n  if (!appEmberVersion) {\n    return false;\n  }\n\n  return satisfies(appEmberVersion, range.value, {\n    includePrerelease: true,\n  });\n}\n"]}