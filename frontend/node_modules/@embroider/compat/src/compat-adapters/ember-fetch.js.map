{"version":3,"file":"ember-fetch.js","sourceRoot":"","sources":["ember-fetch.ts"],"names":[],"mappings":";;;;;AAAA,uCAAwC;AACxC,iEAAuC;AACvC,2DAAkC;AAClC,+BAA+B;AAC/B,2BAAmC;AAEnC,eAAqB,SAAQ,kBAAO;IAClC,IAAI,WAAW;QACb,IAAI,MAAM,GAAG,KAAK,CAAC,WAAW,CAAC;QAC/B,MAAM,CAAC,iBAAiB,CAAC,GAAG;YAC1B,KAAK,EAAE,sBAAsB;SAC9B,CAAC;QACF,OAAO,MAAM,CAAC;IAChB,CAAC;IACD,IAAI,MAAM;QACR,yEAAyE;QACzE,2EAA2E;QAC3E,uBAAuB;QACvB,OAAO,IAAI,qBAAS,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,UAAkB,EAAE,EAAE;YACxD,IAAI,UAAU,GAAG,IAAA,cAAO,EAAC,UAAU,EAAE,uBAAuB,CAAC,CAAC;YAC9D,IAAI,GAAG,GAAG,IAAA,uBAAY,EAAC,UAAU,EAAE,MAAM,CAAC,CAAC;YAC3C,0EAA0E;YAC1E,wEAAwE;YACxE,kEAAkE;YAClE,kCAAkC;YAClC,IAAA,kBAAa,EAAC,UAAU,EAAE,EAAE,CAAC,CAAC;YAC9B,IAAA,kBAAa,EACX,IAAA,cAAO,EAAC,UAAU,EAAE,UAAU,CAAC,EAC/B;;;;;;;;;;;;EAYN,GAAG;;;;;;;;CAQJ,CACM,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC;CACF;AA9CD,4BA8CC","sourcesContent":["import { readFileSync } from 'fs-extra';\nimport AddToTree from '../add-to-tree';\nimport V1Addon from '../v1-addon';\nimport { resolve } from 'path';\nimport { writeFileSync } from 'fs';\n\nexport default class extends V1Addon {\n  get packageMeta() {\n    let result = super.packageMeta;\n    result['renamed-modules'] = {\n      fetch: 'ember-fetch/index.js',\n    };\n    return result;\n  }\n  get v2Tree() {\n    // ember-fetch attempts to emits an AMD define into vendor.js. We instead\n    // adapt it into an ES module, so it can continue accessing ember even once\n    // ember is not in AMD.\n    return new AddToTree(super.v2Tree, (outputPath: string) => {\n      let vendorFile = resolve(outputPath, 'vendor/ember-fetch.js');\n      let src = readFileSync(vendorFile, 'utf8');\n      // the addon has already done \"app.import('vendor/ember-fetch.js')\", which\n      // pushes it onto a list down inside the guts of ember-cli. If we delete\n      // the file, we'll get a crash when ember-cli goes looking for it.\n      // Instead, we just make it empty.\n      writeFileSync(vendorFile, '');\n      writeFileSync(\n        resolve(outputPath, 'index.js'),\n        `import Ember from 'ember';\nconst outputs = {};\n\nfunction define(name, deps, fn) {\n  if (name !== 'fetch') {\n    throw new Error('bug: we were attempting to capture ember-fetch');\n  }\n  if (deps[0] !== 'exports' && deps[1] !== 'ember') {\n    throw new Error('bug: we unexpected deps while capturing ember-fetch');\n  }\n  fn(outputs, Ember);\n}\n${src}\nexport default outputs.default;\nexport const Headers = outputs.Headers;\nexport const Request = outputs.Request;\nexport const Response = outputs.Response;\nexport const AbortController = outputs.AbortController;\nexport const AbortSignal = outputs.AbortSignal;\nexport const fetch = outputs.fetch;\n`\n      );\n    });\n  }\n}\n"]}